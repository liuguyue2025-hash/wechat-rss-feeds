name: Update RSS Feeds

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥2ç‚¹æ›´æ–°ï¼ˆUTCæ—¶é—´ï¼‰
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main, master ]
    paths:
      - 'wechat-rss-accounts.json'
      - 'wechat-rss-manager-lark.sh'

jobs:
  update:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup permissions
        run: |
          chmod +x ./wechat-rss-manager-lark.sh

      - name: Generate RSS feeds
        run: |
          ./wechat-rss-manager-lark.sh generate-all

      - name: Setup GitHub Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Get deployment info
        run: |
          echo "ğŸš€ RSS feeds deployed to: ${{ steps.deployment.outputs.url }}"
          echo "ğŸ“Š Total RSS files: $(ls -1 rss/*.xml | wc -l)"

  notify:
    runs-on: ubuntu-latest
    needs: update
    if: always()

    steps:
      - name: Notification on success
        if: needs.update.result == 'success'
        run: |
          echo "âœ… RSS feeds updated successfully!"
          echo "ğŸ”— Access your feeds at: ${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"

      - name: Notification on failure
        if: needs.update.result == 'failure'
        run: |
          echo "âŒ RSS feeds update failed!"
          echo "ğŸ“ Check the logs for more details"